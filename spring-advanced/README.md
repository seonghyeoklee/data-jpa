## 개요

스프링 핵심 원리 - 고급편 강의를 학습 후 내용을 정리하는 글입니다. 스프링 프레임워크는 다양한 서버에서 사용하는 기술로 백엔드 서버를 개발하기 위한 수많은 기술을 제공하고 있습니다.
이번 포스팅을 주제는 **동시성 문제와 ThreadLocal** 입니다.

### 로그 추적기 개발
우선 주어진 문제를 살펴보자. 애플리케이션을 개발하는데 어디서 에러가 발생하는지 추적해야 하는 상황이라고 가정하자.
로그 추적기는 애플리케이션의 모니터링을 위해 만들어졌고 어디에서 실행되고 어떤부분에서 에러가 발생하는지 해당 로그를 생성하는 것이 목적이다.

#### 로그 추적기 요구사항
- 모든 PUBLIC 메서드의 호출과 응답 정보를 로그로 출력
- 애플리케이션의 흐름을 변경하면 안됨
- 메서드 호출에 걸린 시간
- 정상 흐름과 예외 흐름 구분
- 메서드 호출의 깊이 표현
- HTTP 요청을 구분

요구사항은 위와 같다. 우선 위와 같은 요구사항을 만족하는 형태는 다음 그림과 같다.

![](https://velog.velcdn.com/images/shlee327/post/6bd5b16b-053e-4bf2-af62-fb9737faa5df/image.jpg)

잘 동작하는 것처럼 보이지만 실제 코드를 살펴보면 많은 문제점을 가지고 있다.
- HTTP 요청을 구분하고 깊이를 표현하기 위해 모든 메서드에 파라미터 형식으로 넘기고 있는 점
- 로그의 시작은 항상 컨트롤러부터 시작해야 한다는 점

로그의 아이디를 동기화하기 위해 모든 메서드에 파라미터를 추가해야 하는 문제를 해결하기 위해 어떤 방법을 사용해야 할까?
